#!/bin/bash

: ${PORT:="3000"}

# cleanup
npm run clean
mkdir -p .bin/public/{js,css}
mkdir -p .bin/lib

# compile
stylus client/css/all.styl -o .bin/public/css --include-css --include client/css --watch &
jade views/**/*.jade -o .bin --client --commonjs --pretty --no-debug
jade views/**/*.jade -o .bin --client --commonjs --pretty --no-debug --watch &
taunus -o
taunus -o --watch &
watchify client/js/main.js -o .bin/public/js/all.js --debug --verbose &

# start nodemon, wait for app.listen, run browser-sync
nodemon app --watch .bin/views/**/* &
procfinder --wait --port $PORT
browser-sync start --files ".bin/**/*" --proxy localhost:$PORT --no-open
